#/bin/bash

kernels=("gzip" "bz2" "lzma")
datasets=("ISP-23" "ISP-24" "Public")

rm -rf Logs output eval.sh.log

echo "Logs generated by Denum are being dumped to the log file eval.sh.log."

for dataset in "${datasets[@]}"; do
	mkdir Logs output Logs/${dataset}
	ln -s /media/ramdisk/data/${dataset}/${dataset}.log Logs/${dataset}
	
	for kernel in "${kernels[@]}"; do
		echo -e "\n"
		
		exe="denum_compress_gz"
		if [[ "$kernel" == "bz2" ]]; then
			exe="denum_compress_bz2"
		elif [[ "$kernel" == "lzma" ]]; then
			exe="denum_compress_7z"		
		fi
		
		echo "###" `date` ": Start evaluating Denum(${kernel}) on ${dataset}" "###"
		
		chmod a+x ./${exe}
		cmd="./${exe} ${dataset} 100000 1 2>&1 >>eval.sh.log"
		bash -c "${cmd}" 2>&1 >/dev/null
		
		echo "------------------Result of Denum(${kernel}) on ${dataset}----------------------"
		tail -n 3 eval.sh.log
		echo "-----------------------------------------------------------------------------------------"
		
		echo "###" `date` ": Finished evaluating Denum(${kernel}) on ${dataset}" "###"
		echo -e "\n"
	done
done
