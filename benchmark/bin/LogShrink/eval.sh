#!/bin/sh

kernels=("gzip" "bz2" "lzma")
datasets=("ISP-23" "ISP-24" "Public")

rm -rf data output eval.sh.log
mkdir data output
chmod a+x python_compression/parser/Elastic python_compression/parser/THULR 

echo "Logs generated by LogShrink are being dumped to the log file eval.sh.log."

for dataset in "${datasets[@]}"; do
	mkdir data/${dataset}
	ln -s /media/ramdisk/data/${dataset}/${dataset}.log data/${dataset}
	for kernel in "${kernels[@]}"; do
		echo -e "\n"
		echo "###" `date` ": Start evaluating LogShrink(${kernel}) on ${dataset}" "###"
		
		cd python_compression/
		cmd="python3 run.py -I ../data/ -ds ${dataset} -E E -C -K ${kernel} -V -P -wh 50 -th 10 -NC 16 -S -outdir ../output/ -TN 1 2>&1 >>../eval.sh.log"
		#cmd="echo 1; echo 2; echo 3;"
		bash -c "${cmd}" 2>&1 >/dev/null
		echo "------------------Result of LogShrink(${kernel}) on ${dataset}----------------------"
		tail -n 3 ../eval.sh.log
		echo "-----------------------------------------------------------------------------------------"
		
		echo "###" `date` ": Finished evaluating LogShrink(${kernel}) on ${dataset}" "###"
		echo -e "\n"
		cd ..
	done
done
