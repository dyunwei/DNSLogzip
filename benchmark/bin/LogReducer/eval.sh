#!/bin/sh

kernels=("lzma")
datasets=("ISP-23" "ISP-24" "Public")

rm -rf data ISP-23 ISP-24 Public ISP-23_output ISP-24_output Public_output eval.sh.log
chmod a+x Elastic Entropy Iddiff Numdiff THULR

echo "Logs generated by LogReducer are being dumped to the log file eval.sh.log."

for dataset in "${datasets[@]}"; do
	mkdir data data/${dataset} ${dataset} ${dataset}_output
	ln -s /media/ramdisk/data/${dataset}/${dataset}.log data/${dataset}
	
	for kernel in "${kernels[@]}"; do
		echo -e "\n"
		echo "###" `date` ": Start evaluating LogReducer(${kernel}) on ${dataset}" "###"
		
		cmd="python3 training.py -I /media/ramdisk/data/${dataset}/${dataset}.log -T ./${dataset}/ 2>&1 >>eval.sh.log"
		bash -c "${cmd}" 2>&1 >/dev/null
		
		cmd="python3 LogReducer.py -I ./data/${dataset}/${dataset}.log -T ./${dataset}/ -O ./${dataset}_output/ -TN 1 2>&1 >>eval.sh.log"
		bash -c "${cmd}" 2>&1 >/dev/null
		
		echo "------------------Result of LogReducer(${kernel}) on ${dataset}----------------------"
		tail -n 3 eval.sh.log
		echo "-----------------------------------------------------------------------------------------"
		
		echo "###" `date` ": Finished evaluating LogReducer(${kernel}) on ${dataset}" "###"
		echo -e "\n"
	done
done
